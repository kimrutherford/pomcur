<%args>
$schema
$title
$pub
$annotation
@annotation_genes
$curs_root_uri
$multi_organism_mode
</%args>

<div ng-app>
<& ontology_allele_edit.mhtml, annotation => $annotation,
   editing => 0,
   curs_root_uri => $curs_root_uri &>

<div ng-controller="AlleleCtrl" id="curs-multi-allele-select" class="curs-box">
  <div class="curs-box-title">
<% $title %>
  </div>
  <div class="curs-box-body">
  
  <form name="multi-allele-select" ng-submit="storeAlleles()">

Add alleles from the genes below until the genotype is fully specified.

  <table class="list">
    <thead>
      <tr>
%     for my $col_name (@col_names) {
        <th>
          <% $col_name %>
        </th>
%     }
        <th>
          &nbsp;
        </th>
      </tr>
    </thead>

%   for my $gene (@gene_data) {
    <tr>
%     for my $col_name (@col_names) {
      <td>
        <% $gene->{$col_name} |n %>
      </td>
%     }
      <td>
        <button type="button"
                name="gene-select"
                data-gene-display-name="<% $gene->{display_name} %>"
                data-gene-primary-identifier="<% $gene->{'Systematic identifier'} %>"
                class="multi-allele-add-from-gene"
                value='<% $gene->{gene_id} %>'>Add allele ..</button>
      </td>
    </tr>
%   }
  </table>

  <div id="multi-allele-genotype" class="ng-cloak" ng-model="allele" ng-show="alleles.length">

<div>
The alleles for this genotype:
</div>

  <table class="list">
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Expression</th>
        <th>Type</th>
      </tr>
    </thead>
    <tbody ng-repeat="allele in alleles">
      <td>{{allele.name}}</td>
      <td>{{allele.description}}</td>
      <td>{{allele.expression}}</td>
      <td>{{allele.type}}</td>
    </tbody>
  </table>
  </div>

  <input type="submit" id="curs-multi-alleles-submit" class="curs-finish-button"
          name="multi-allele-finish" value="Finish ..." />
</form>
</div>
</div>
</div>

<%init>
use PomCur::Curs;
use PomCur::Track;
use PomCur::Curs::GeneProxy;

my @gene_data = map {
  my $gene = $_;

  my $hash = {
    'Systematic identifier' => $gene->primary_identifier(),
    Name => $gene->primary_name(),
    Product => $gene->product(),
    gene_id => $gene->gene_id(),
    display_name => $gene->display_name(),
  };
  if ($multi_organism_mode) {
    $hash->{Organism} = $gene->organism()->full_name();
  }
  $hash
} @annotation_genes;

my @col_names = ("Systematic identifier", "Name", "Product");

if ($multi_organism_mode) {
  push @col_names, "Organism";
}
</%init>
